---
title : "Add GraphQL Queries to Connect Real Data"
date : "2025-06-14"
weight : 2 
chapter : false
pre : " <b> 3.2. </b> "
---

After defining the data schema and pushing it to DynamoDB using the Amplify CLI, the next step is to **connect the frontend to the real database** using the **auto-generated GraphQL queries and mutations**.

---

### Objectives

- Connect the frontend to DynamoDB using the GraphQL API provided by Amplify.
- Replace mock data with real backend data.
- Update the *bookTicket()* function to persist booked tickets to DynamoDB.

---

### GraphQL Structure Auto-Generated by Amplify

After running `amplify push`, the *src/graphql/* folder will be created. Inside, you will find:

- *mutations.ts*: Defines data update operations (create, update, delete)
- *queries.ts*: Defines data queries (get, list)
- *subscriptions.ts*: Enables real-time updates (not used in this lab)
- *schema.json*: Entire schema in JSON format

### Update *data.ts* Source Code

#### Step 1: Add required imports (at the top of the file)

```ts
// Amplify GraphQL
import { listEvents, listRooms } from '@/graphql/queries';
import { deleteRoom, deleteEvent, createEvent, createRoom, updateEvent } from '@/graphql/mutations';
import { generateClient } from 'aws-amplify/api';

// Create GraphQL API client
const apiClient = generateClient();
```
#### Step 2: Replace the fetchData() function
```ts
async fetchData() {
  const dbRooms = await apiClient.graphql({ query: listRooms });
  const dbEvents = await apiClient.graphql({ query: listEvents });

  this.rooms = dbRooms.data.listRooms.items.map(room => {
    return new Room(room.id, room.name, room.capacity, []);
  });

  this.events = dbEvents.data.listEvents.items.map(event => {
    let ev = new EventDetails(
      event.id,
      event.name,
      event.description,
      event.event_owner,
      event.room_id,
      event.image_file_name,
      new Date(event.event_datetime_start),
      new Date(event.event_datetime_end),
      event.event_duration,
      event.total_tickets,
      event.tickets
    );
    event.tickets.forEach(ticket => {
      ev.bookTicket(ticket);
    });
    return ev;
  });
}
```
#### Step 3: Update bookTicket() function
```ts
async bookTicket(eventId: string, studentId: string) {
  const event = this.events.find(e => e.id === eventId);
  if (event && event.total_tickets > event.tickets.length) {
    event.bookTicket(studentId);

    // Đồng bộ vé đã đặt lên DynamoDB
    const input = {
      id: event.id,
      tickets: event.tickets,
    };

    const updatedEvent = await apiClient.graphql({
      query: updateEvent,
      variables: { input }
    });

    console.log('Ticket booked:', updatedEvent);
  }
}
```
---

### Run the Application

To test the connection with the backend, you need to launch the frontend application. Open your terminal and follow these steps:  
Step 1. Make sure you are in the root directory of the project (where *package.json* is located).  
Step 2. Run the following command to install dependencies:
```bash
npm install
```
Step 3. Once the installation is complete, you will see a message like this:
```bash
Vite v4.6.0  ready in 300 ms
➜ Local:   http://localhost:3000/
➜ Network: use `--host` to expose
```
Step 4. Open your browser and go to [http://localhost:3000](http://localhost:3000), then follow these steps:  
- Login.
![Login](/images/3.connect/02-LogIn.png) 
> When logging in, you will see the **My Tickets** button activated.

![Login](/images/3.connect/02-LogIn1.png) 
- Click on the About App button (top right corner), and you will see a dialog displaying the options:
  - Generate Mock Data: Create mock data for testing.
  - Upload Mock Data to DynamoDB: Push mock data to DynamoDB.
  - Select Close to close the dialog.
![About](/images/3.connect/02-LogIn2.png) 
- Choose:  
  - Generate Mock Data: Generate mock data for testing. At this point, you will see a list of events and rooms displayed from the mock data.
![Data](/images/3.connect/02-LogIn3.png) 
  - Select Close to close the dialog box.  
You will then see a list of events and rooms displayed from real data in DynamoDB.  
![Login](/images/3.connect/02-LogIn4.png) 

- Select an event and book tickets using the Book Ticket button.  
![Book Ticket](/images/3.connect/02-BookTicket.png) 
- After booking a ticket, you can see the Ticket Availables item decrease and the booked ticket will be saved in DynamoDB.  
![Book Ticket](/images/3.connect/02-BookTicket1.png) 
- Go to My Tickets, you will see the ticket you just booked displayed.  
![Book Ticket](/images/3.connect/02-BookTicket2.png)

{{% notice tip %}}
Once the application has successfully connected to the backend, you can go to the AWS Console to **confirm that data has been written to DynamoDB**.
{{% /notice %}}

---

### View Data in DynamoDB

**Step 1: Access the AWS Console**  
- Go to: [https://console.aws.amazon.com/](https://console.aws.amazon.com/)  
- Log in using the AWS account you used when initializing Amplify.  

**Step 2: Select the correct region**  
- In the top-right corner, select **Asia Pacific (Singapore) - `ap-southeast-1`** for the best performance.

{{% notice warning %}}  
This is the region you selected during `amplify init`, so make sure it's correct to see your resources.  
{{% /notice %}}

**Step 3: Open the DynamoDB service**  
- Search for `DynamoDB` in the top search bar.  
- Click on the **DynamoDB** result.  
![DB](/images/3.connect/03-DB.png)

**Step 4: View data tables**  
- In the left sidebar, select **Tables**.  
- Look for table names like:  
```text
Event-XXXXX-dev
Room-XXXXX-dev
```
{{% notice warning %}}
Table names may vary depending on your project name and environment (dev, staging...).
{{% /notice %}}

- Click on the **Event-XXXXX-dev** table to view the event data.  
- You will see records created by your app, including fields like id, name, description, event_owner, room_id, event_datetime_start, event_datetime_end, total_tickets, and a tickets array containing user IDs who booked the event.  
- Similarly, you can open the Room-XXXXX-dev table to view room data.  
![DB](/images/3.connect/03-DB1.png)

{{% notice info %}}
You have successfully replaced all mock data with a real data system stored in the cloud using DynamoDB.
{{% /notice %}}

{{% notice tip %}}
You can continue expanding the application with features such as: Creating/Deleting events from the UI, Connecting event images with Amazon S3, Adding role-based access control.  
These features may be explored in future workshops.
{{% /notice %}}

---

### Conclusion

- The frontend application has been successfully connected to DynamoDB through automatically generated GraphQL queries and mutations using Amplify.  
- Features such as viewing events, viewing rooms, and booking tickets are now backed by real cloud data instead of mock data.  
- All user actions, such as ticket booking, are recorded and synchronized in both directions between the client and the backend system on AWS.
